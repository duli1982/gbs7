<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's New - Content Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="shared/hub-button.css">
    <style>
        body { font-family: 'Roboto', sans-serif; }
        .google-sans { font-family: 'Google Sans', sans-serif; }
        .admin-section { background: linear-gradient(135deg, #f8fafc, #e2e8f0); }
        .json-editor { font-family: 'Courier New', monospace; }
        .preview-card { transition: all 0.3s ease; }
        .preview-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50">
    <a href="index.html" class="hub-button">‚Üê Back to Hub</a>

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="google-sans text-4xl font-bold text-gray-900">What's New - Content Manager</h1>
            <p class="text-lg text-gray-600 mt-4">Manage updates, announcements, and content highlights</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto">
            <!-- JSON Editor Section -->
            <div class="admin-section p-6 rounded-xl border">
                <h2 class="text-2xl font-bold mb-4">Content Editor</h2>
                <p class="text-gray-600 mb-6">Edit the JSON data to add new updates or modify existing ones:</p>
                
                <div class="mb-4">
                    <label class="block text-sm font-semibold mb-2">What's New Data (JSON):</label>
                    <textarea id="jsonEditor" class="json-editor w-full h-96 p-4 border rounded-lg bg-gray-800 text-green-400 text-sm" 
                              placeholder="Loading JSON data..."></textarea>
                </div>

                <div class="flex gap-4">
                    <button id="validateBtn" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Validate JSON
                    </button>
                    <button id="previewBtn" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        Preview Changes
                    </button>
                    <button id="saveBtn" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                        Save Changes
                    </button>
                </div>

                <div id="validation-status" class="mt-4 p-3 rounded-lg hidden">
                    <div id="validation-message"></div>
                </div>
            </div>

            <!-- Live Preview Section -->
            <div class="bg-white p-6 rounded-xl border">
                <h2 class="text-2xl font-bold mb-4">Live Preview</h2>
                <p class="text-gray-600 mb-6">See how your changes will appear on the homepage:</p>

                <!-- Announcements Preview -->
                <div id="preview-announcements" class="mb-6">
                    <h3 class="font-bold text-lg mb-3">üì¢ Announcements</h3>
                    <div id="preview-announcements-content">
                        <!-- Announcements will be rendered here -->
                    </div>
                </div>

                <!-- Updates Preview -->
                <div id="preview-updates">
                    <h3 class="font-bold text-lg mb-3">üÜï Recent Updates</h3>
                    <div id="preview-updates-content" class="space-y-4">
                        <!-- Updates will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Add Forms -->
        <div class="max-w-4xl mx-auto mt-12">
            <div class="bg-white p-8 rounded-xl border">
                <h2 class="text-2xl font-bold mb-6">Quick Add New Update</h2>
                
                <form id="quickAddForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Type:</label>
                            <select id="updateType" class="w-full p-3 border rounded-lg">
                                <option value="new-content">New Content</option>
                                <option value="feature">Feature Update</option>
                                <option value="success-story">Success Story</option>
                                <option value="update">Content Update</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Icon:</label>
                            <select id="updateIcon" class="w-full p-3 border rounded-lg">
                                <option value="üéØ">üéØ Target</option>
                                <option value="üíé">üíé Gem</option>
                                <option value="üìà">üìà Growth</option>
                                <option value="‚ö°">‚ö° Lightning</option>
                                <option value="üéì">üéì Education</option>
                                <option value="üîç">üîç Search</option>
                                <option value="üöÄ">üöÄ Rocket</option>
                                <option value="‚ú®">‚ú® Sparkles</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2">Title:</label>
                        <input type="text" id="updateTitle" class="w-full p-3 border rounded-lg" 
                               placeholder="Enter update title">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-2">Description:</label>
                        <textarea id="updateDescription" class="w-full p-3 border rounded-lg h-24" 
                                  placeholder="Enter update description"></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Category:</label>
                            <input type="text" id="updateCategory" class="w-full p-3 border rounded-lg" 
                                   placeholder="e.g., Training Content">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Link:</label>
                            <input type="text" id="updateLink" class="w-full p-3 border rounded-lg" 
                                   placeholder="/path/to/content">
                        </div>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                            Add Update
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Instructions -->
        <div class="max-w-4xl mx-auto mt-12 bg-blue-50 p-8 rounded-xl border border-blue-200">
            <h2 class="text-xl font-bold text-blue-900 mb-4">üìã Instructions</h2>
            <div class="space-y-4 text-blue-800">
                <div>
                    <h3 class="font-semibold">Adding New Updates:</h3>
                    <p class="text-sm">Use the Quick Add form above or edit the JSON directly. Each update should have a unique ID.</p>
                </div>
                <div>
                    <h3 class="font-semibold">Update Types:</h3>
                    <ul class="text-sm space-y-1 ml-4">
                        <li>‚Ä¢ <strong>new-content:</strong> Brand new training modules, lessons, or resources</li>
                        <li>‚Ä¢ <strong>feature:</strong> New platform features or tools</li>
                        <li>‚Ä¢ <strong>success-story:</strong> Case studies and success examples</li>
                        <li>‚Ä¢ <strong>update:</strong> Improvements to existing content</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold">Priority Announcements:</h3>
                    <p class="text-sm">Set priority to "high" for announcements that should appear in the prominent announcement bar.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class WhatsNewAdmin {
            constructor() {
                this.jsonEditor = document.getElementById('jsonEditor');
                this.previewAnnouncementsContent = document.getElementById('preview-announcements-content');
                this.previewUpdatesContent = document.getElementById('preview-updates-content');
                this.validationStatus = document.getElementById('validation-status');
                this.validationMessage = document.getElementById('validation-message');

                this.loadCurrentData();
                this.initializeEventListeners();
            }

            async loadCurrentData() {
                try {
                    const response = await fetch('shared/whats-new.json');
                    const data = await response.json();
                    this.jsonEditor.value = JSON.stringify(data, null, 2);
                    this.updatePreview(data);
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showValidationMessage('Error loading current data', 'error');
                }
            }

            initializeEventListeners() {
                document.getElementById('validateBtn').addEventListener('click', () => this.validateJSON());
                document.getElementById('previewBtn').addEventListener('click', () => this.previewChanges());
                document.getElementById('saveBtn').addEventListener('click', () => this.saveChanges());
                document.getElementById('quickAddForm').addEventListener('submit', (e) => this.handleQuickAdd(e));
            }

            validateJSON() {
                try {
                    const data = JSON.parse(this.jsonEditor.value);
                    this.showValidationMessage('‚úÖ JSON is valid!', 'success');
                    return data;
                } catch (error) {
                    this.showValidationMessage(`‚ùå JSON Error: ${error.message}`, 'error');
                    return null;
                }
            }

            previewChanges() {
                const data = this.validateJSON();
                if (data) {
                    this.updatePreview(data);
                }
            }

            updatePreview(data) {
                this.renderAnnouncementsPreview(data.announcements || []);
                this.renderUpdatesPreview(data.updates || []);
            }

            renderAnnouncementsPreview(announcements) {
                const highPriority = announcements.filter(a => a.priority === 'high');
                
                if (highPriority.length === 0) {
                    this.previewAnnouncementsContent.innerHTML = '<p class="text-gray-500">No high priority announcements</p>';
                    return;
                }

                this.previewAnnouncementsContent.innerHTML = highPriority.map(announcement => `
                    <div class="flex items-center gap-4 p-4 bg-yellow-100 border border-yellow-300 rounded-lg mb-2">
                        <div class="text-2xl">${announcement.icon}</div>
                        <div class="flex-1">
                            <div class="font-bold">${announcement.title}</div>
                            <div class="text-sm text-gray-600">${announcement.description}</div>
                        </div>
                        <div class="px-3 py-1 bg-white rounded text-sm font-semibold">${announcement.actionText}</div>
                    </div>
                `).join('');
            }

            renderUpdatesPreview(updates) {
                if (updates.length === 0) {
                    this.previewUpdatesContent.innerHTML = '<p class="text-gray-500">No updates available</p>';
                    return;
                }

                // Sort and show first 3
                const sortedUpdates = [...updates].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 3);

                this.previewUpdatesContent.innerHTML = sortedUpdates.map(update => {
                    const badgeColors = {
                        'new-content': 'bg-green-500',
                        'feature': 'bg-blue-500', 
                        'success-story': 'bg-yellow-500',
                        'update': 'bg-purple-500'
                    };

                    return `
                        <div class="preview-card p-4 border rounded-lg bg-white">
                            <div class="flex items-start justify-between mb-2">
                                <div class="text-2xl">${update.icon}</div>
                                <div class="px-2 py-1 ${badgeColors[update.type] || 'bg-gray-500'} text-white text-xs rounded-full">${update.badge}</div>
                            </div>
                            <div class="font-bold mb-1">${update.title}</div>
                            <div class="text-sm text-gray-600 mb-2">${update.description}</div>
                            <div class="flex justify-between items-center text-xs">
                                <span class="bg-gray-100 px-2 py-1 rounded">${update.category}</span>
                                <span class="text-gray-500">${new Date(update.date).toLocaleDateString()}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            showValidationMessage(message, type) {
                this.validationStatus.className = `mt-4 p-3 rounded-lg ${type === 'success' ? 'bg-green-100 border border-green-300' : 'bg-red-100 border border-red-300'}`;
                this.validationMessage.textContent = message;
                this.validationStatus.classList.remove('hidden');

                setTimeout(() => {
                    this.validationStatus.classList.add('hidden');
                }, 5000);
            }

            handleQuickAdd(e) {
                e.preventDefault();
                
                const newUpdate = {
                    id: `update-${Date.now()}`,
                    type: document.getElementById('updateType').value,
                    title: document.getElementById('updateTitle').value,
                    description: document.getElementById('updateDescription').value,
                    category: document.getElementById('updateCategory').value,
                    date: new Date().toISOString().split('T')[0],
                    link: document.getElementById('updateLink').value,
                    badge: this.getBadgeFromType(document.getElementById('updateType').value),
                    icon: document.getElementById('updateIcon').value
                };

                // Add to existing JSON
                try {
                    const currentData = JSON.parse(this.jsonEditor.value);
                    currentData.updates.unshift(newUpdate); // Add to beginning
                    this.jsonEditor.value = JSON.stringify(currentData, null, 2);
                    this.updatePreview(currentData);
                    this.showValidationMessage('‚úÖ Update added successfully!', 'success');
                    
                    // Clear form
                    document.getElementById('quickAddForm').reset();
                } catch (error) {
                    this.showValidationMessage(`‚ùå Error adding update: ${error.message}`, 'error');
                }
            }

            getBadgeFromType(type) {
                const badges = {
                    'new-content': 'NEW',
                    'feature': 'FEATURE',
                    'success-story': 'SUCCESS',
                    'update': 'UPDATED'
                };
                return badges[type] || 'NEW';
            }

            saveChanges() {
                const data = this.validateJSON();
                if (!data) return;

                // In a real implementation, this would send the data to a server
                // For now, we'll just show a message and download the JSON
                this.downloadJSON(data);
                this.showValidationMessage('‚úÖ Changes saved! Download the JSON file and replace shared/whats-new.json', 'success');
            }

            downloadJSON(data) {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'whats-new.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', () => {
            new WhatsNewAdmin();
        });
    </script>
</body>
</html>